generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                      @id @default(cuid())
  workos_user_id          String?                     @unique
  name                    String?
  email                   String?                     @unique
  emailVerified           DateTime?                   @map("email_verified")
  image                   String?
  username                String?                     @unique
  password                String
  firstName               String
  midName                 String?
  lastName                String
  isActive                Boolean                     @default(true)
  info                    Json
  createdAt               DateTime                    @default(now())
  updatedAt               DateTime?                   @updatedAt
  sub_organizationId      Int?
  projects                projects[]
  organization_memberships organization_memberships[]
  sub_organization        sub_organizations?          @relation(fields: [sub_organizationId], references: [id], onDelete: Cascade)
  role_assignments        user_role_assignments[]

  @@index([sub_organizationId])
  @@index([workos_user_id])
  @@index([isActive])
  @@map("users")
}

model organizations {
  id                      String                      @id @default(uuid())
  workos_org_id           String?                     @unique
  title                   String
  description             String?
  createdAt               DateTime                    @default(now())
  lastUpdated             DateTime                    @default(now())
  updatedby               String
  createdBy               String
  info                    Json?
  logo_url                String?
  status                  String?
  type                    String?
  notes                   String?
  published               Boolean
  sub_organizations       sub_organizations[]
  organization_memberships organization_memberships[]
  subscription            subscriptions?
  user_role_assignments   user_role_assignments[]
  organization_role_overrides organization_role_overrides[]

  @@index([workos_org_id])
}

model sub_organizations {
  id                  Int                                 @id @default(autoincrement())
  title               String
  description         String?
  createdAt           DateTime                            @default(now())
  lastUpdated         DateTime                            @default(now())
  updatedby           String
  createdBy           String
  organizationId      String
  course_tags         course_tags[]
  courses             courses[]
  curriculums         curriculums[]
  instructors         instructors[]
  projects            projects[]
  participant_roles   sub_organization_participant_role[]
  organization        organizations                       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  topics              topics[]
  training_recipients training_recipients[]
  users               User[]

  @@index([organizationId])
}

model sub_organization_participant_role {
  id                       Int                        @id @default(autoincrement())
  title                    String
  description              String?
  sub_organizationId       Int
  isActive                 Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  createdBy                String
  updatedBy                String?
  course_participant_roles course_participant_roles[]
  module_participant_roles module_participant_roles[]
  participants             participants[]
  sub_organization         sub_organizations          @relation(fields: [sub_organizationId], references: [id], onDelete: Cascade)

  @@unique([title, sub_organizationId], name: "unique_role_per_organization")
  @@index([sub_organizationId])
  @@index([title])
  @@index([isActive])
}

model training_recipients {
  id                   Int                        @id @default(autoincrement())
  name                 String
  description          String?
  contactPerson        String?
  email                String?
  phone                String?
  address              String?
  website              String?
  industry             String?
  taxId                String?
  notes                String?
  location             Json?
  img                  String?
  status               String                     @default("active")
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime                   @updatedAt
  createdBy            String
  updatedBy            String?
  sub_organizationId   Int
  participants         participants[]
  projects             projects[]
  project_participants project_participants[]
  rooms                rooms[]
  sub_organization     sub_organizations          @relation(fields: [sub_organizationId], references: [id], onDelete: Cascade)

  @@index([sub_organizationId])
  @@index([status])
}

model projects {
  id                                 Int                                           @id @default(autoincrement())
  cuid                               String
  sub_organizationId                 Int
  createdAt                          DateTime                                      @default(now())
  lastUpdated                        DateTime                                      @default(now())
  updatedby                          String?
  CreatedBy                          String
  published                          Boolean                                       @default(false)
  title                              String
  summary                            String?                                       @db.VarChar(1000)
  duration                           Int?
  tags                               Json?
  projectType                        String?
  projectCategory                    String?
  projectStatus                      String
  startDate                          DateTime?
  endDate                            DateTime?
  backgroundImg                      String?
  color                              String?
  language                           String                                        @default("English")
  location                           Json?
  trainingRecipientId                Int?
  assessment_configs                 project_assessment_config[]
  daily_focus                        daily_focus[]
  daily_training_notes               daily_training_notes[]
  events                             events[]
  groups                             groups[]
  checklist_progress                 project_course_checklist_progress[]
  curriculum_checklist_progress      project_curriculum_checklist_progress[]
  participant_checklist_progress     project_participants_course_checklist_progress[]
  project_curriculums                project_curriculums[]
  project_instructors                project_instructors[]
  participants                       project_participants[]
  project_settings                   project_settings?
  project_topics                     project_topics[]
  user                               User                                          @relation(fields: [CreatedBy], references: [id])
  sub_organization                   sub_organizations                             @relation(fields: [sub_organizationId], references: [id])
  training_recipient                 training_recipients?                          @relation(fields: [trainingRecipientId], references: [id])
  training_plans                     training_plans[]
  parking_lot_items                  parking_lot_items[]

  @@index([CreatedBy])
  @@index([sub_organizationId])
  @@index([trainingRecipientId])
}

model parking_lot_items {
  id                 Int               @id @default(autoincrement())
  projectId          Int
  type               String            @default("issue") // 'issue' or 'question'
  title              String
  description        String?
  priority           String            @default("medium") // 'low', 'medium', 'high'
  status             String            @default("open") // 'open', 'in_progress', 'resolved'
  reportedDate       DateTime          @default(now())
  solvedDate         DateTime?
  reportedBy         String?
  notes              String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  createdBy          String?
  updatedBy          String?

  project            projects          @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([status])
}

model instructors {
  id                  Int                           @id @default(autoincrement())
  firstName           String
  lastName            String
  email               String                        @unique
  phone               String?
  bio                 String?
  expertise           String[]
  instructorType      String                        @default("main")
  status              String                        @default("active")
  profileImage        String?
  qualifications      Json?
  hourlyRate          Float?
  availability        Json?
  sub_organizationId  Int
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime                      @updatedAt
  createdBy           String
  updatedBy           String?
  assessment_scores   participant_assessment_scores[]
  course_instructors  course_instructors[]
  event_instructors   event_instructors[]
  sub_organization    sub_organizations             @relation(fields: [sub_organizationId], references: [id], onDelete: Cascade)
  project_instructors project_instructors[]

  @@index([sub_organizationId])
  @@index([instructorType])
  @@index([status])
}

model project_instructors {
  id             Int         @id @default(autoincrement())
  projectId      Int
  instructorId   Int
  instructorType String      @default("main")
  createdAt      DateTime    @default(now())
  lastUpdated    DateTime    @default(now())
  instructor     instructors @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  project        projects    @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, instructorId], name: "projectId_instructorId")
  @@index([projectId])
  @@index([instructorId])
}

model project_settings {
  id             Int       @id @default(autoincrement())
  projectId      Int       @unique
  startDate      DateTime?
  endDate        DateTime?
  startOfDayTime String    @default("09:00")
  endOfDayTime   String    @default("17:00")
  lunchTime      String?   @default("12:00-13:00")
  timezone       String    @default("UTC")
  workingDays    String[]  @default(["monday", "tuesday", "wednesday", "thursday", "friday"])
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  createdBy      String
  updatedBy      String?
  project        projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model participants {
  id                  String                             @id @default(uuid())
  firstName           String
  middleName          String?
  lastName            String
  email               String
  participantStatus   String?
  participantType     String?
  sub_organization    Int
  trainingRecipientId Int?
  derpartement        String?
  tag                 String?                            @default("")
  roleId              Int?
  notes               String?
  profilePrefs        Json
  profileImg          String?
  credentials         Json
  createdAt           DateTime                           @default(now())
  lastUpdated         DateTime?                          @default(now())
  updatedby           String?
  createdBy           String?
  role                sub_organization_participant_role? @relation(fields: [roleId], references: [id])
  training_recipient  training_recipients?               @relation(fields: [trainingRecipientId], references: [id])
  projects            project_participants[]
  toolAccesses        toolAccesses[]

  @@unique([email, sub_organization])
  @@index([trainingRecipientId])
  @@index([roleId])
  @@index([sub_organization])
}

model project_curriculums {
  id           Int         @id @default(autoincrement())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @default(now())
  projectId    Int
  curriculumId Int
  curriculum   curriculums @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  project      projects    @relation(fields: [projectId], references: [id])

  @@unique([projectId, curriculumId], name: "projectId_curriculumId")
  @@index([curriculumId])
  @@index([projectId])
}

model project_participants {
  id                                  Int                                           @id @default(autoincrement())
  projectId                           Int
  participantId                       String
  trainingRecipientId                 Int?
  status                              String                                        @default("active")
  note                                String?                                       @db.VarChar(2000)
  assessment_scores                   participant_assessment_scores[]
  courses_enrollee_progress           courses_enrollee_progress[]
  event_attendees                     event_attendees[]
  group                               group_participants[]
  checklist_progress                  project_participants_course_checklist_progress[]
  participant                         participants                                  @relation(fields: [participantId], references: [id], onDelete: Cascade)
  project                             projects                                      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  training_recipient                  training_recipients?                          @relation(fields: [trainingRecipientId], references: [id])

  @@unique([projectId, participantId])
  @@index([projectId])
  @@index([participantId])
  @@index([trainingRecipientId])
}

model groups {
  id                Int                  @id @default(autoincrement())
  groupName         String
  projectId         Int
  chipColor         String
  event_groups      event_groups[]
  group_curriculums group_curriculums[]
  participants      group_participants[]
  project           projects             @relation(fields: [projectId], references: [id])

  @@index([projectId])
}

model group_participants {
  id            Int                  @id @default(autoincrement())
  groupId       Int
  participantId Int
  group         groups               @relation(fields: [groupId], references: [id], onDelete: Cascade)
  participant   project_participants @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([groupId, participantId])
  @@index([groupId])
  @@index([participantId])
}

model tags {
  id          Int           @id @default(autoincrement())
  title       String
  course_tags course_tags[]
}

model course_tags {
  id                   Int               @id @default(autoincrement())
  courseId             Int
  tagId                Int
  sub_organizationId   Int
  courseInfo           courses           @relation(fields: [courseId], references: [id])
  sub_organizationInfo sub_organizations @relation(fields: [sub_organizationId], references: [id])
  TagInfo              tags              @relation(fields: [tagId], references: [id])

  @@index([sub_organizationId])
  @@index([tagId])
  @@index([courseId])
}

model courses {
  id                        Int                         @id @default(autoincrement())
  cuid                      String                      @default(cuid())
  sub_organizationId        Int
  createdAt                 DateTime?                   @default(now())
  createdBy                 String
  lastUpdated               DateTime?                   @updatedAt
  published                 Boolean?
  title                     String
  summary                   String?
  language                  String?
  deliveryMethod            String?
  goLiveDate                DateTime?
  maxParticipants           Int?
  deadline                  DateTime?
  duration                  Int?
  cost                      Float?
  level                     String?
  accessRestrictions        String?
  certification             String?
  tags                      String?
  CourseType                String?
  courseCategory            String?
  courseStatus              String?
  isActive                  Boolean                     @default(true)
  targetAudience            String?
  isMandatoryToAllRole      Boolean                     @default(false)
  backgroundImg             String?
  resources                 String?
  syllabusId                Int?
  JSONSyllabus              Json?
  rating                    Float?
  code                      String?
  version                   String?
  course_assessments        course_assessments[]
  course_checklist_items    course_checklist_items[]
  course_instructors        course_instructors[]
  course_objectives         course_objectives[]
  course_participant_roles  course_participant_roles[]
  course_tags               course_tags[]
  course_topics             course_topics[]
  sub_organizationInfo      sub_organizations           @relation(fields: [sub_organizationId], references: [id])
  courses_enrollee_progress courses_enrollee_progress[]
  curriculum_courses        curriculum_courses[]
  events                    events[]
  modules                   modules[]
  survey_triggers           curriculum_surveys[]        @relation("SurveyTriggerCourse")
  training_plan_modules     training_plan_modules[]

  @@index([sub_organizationId])
  @@index([isActive])
}

model courses_enrollee_progress {
  id          Int                  @id @default(autoincrement())
  courseId    Int
  enrolleeId  Int
  completed   Boolean              @default(false)
  createdAt   DateTime             @default(now())
  lastUpdated DateTime             @default(now())
  updatedby   String?
  createdBy   String?
  course      courses              @relation(fields: [courseId], references: [id])
  enrollee    project_participants @relation(fields: [enrolleeId], references: [id])

  @@unique([courseId, completed, enrolleeId])
  @@index([courseId])
  @@index([enrolleeId])
}

model modules {
  id                       Int                        @id @default(autoincrement())
  createdAt                DateTime                   @default(now())
  lastUpdated              DateTime                   @updatedAt
  published                Boolean
  title                    String
  summary                  String?
  content                  String?
  JSONContent              Json?
  duration                 Int?
  customDuration           Int?
  level                    String?
  moduleStatus             String?
  backgroundImg            String?
  courseId                 Int
  moduleOrder              Int?
  activities               activities[]
  course_checklist_items   course_checklist_items[]
  module_objectives        module_objectives[]
  module_participant_roles module_participant_roles[]
  event_module_progress    event_module_progress[]
  course                   courses                    @relation(fields: [courseId], references: [id])
  training_plan_modules    training_plan_modules[]

  @@index([courseId])
}

model curriculums {
  id                       Int                                   @id @default(autoincrement())
  cuid                     String                                @default(cuid())
  title                    String
  description              String?
  isDefault                Boolean                               @default(false)
  sub_organizationId       Int
  createdAt                DateTime                              @default(now())
  updatedAt                DateTime                              @default(now())
  assessment_configs       curriculum_assessment_config[]
  curriculum_checklist_items curriculum_checklist_items[]
  curriculum_courses       curriculum_courses[]
  curriculum_surveys       curriculum_surveys[]
  group_curriculums        group_curriculums[]
  project_curriculums      project_curriculums[]
  supportActivities        supportActivities[]
  training_plans           training_plans[]
  sub_organization         sub_organizations                     @relation(fields: [sub_organizationId], references: [id], onDelete: Cascade)

  @@index([sub_organizationId])
}

model curriculum_courses {
  id           Int         @id @default(autoincrement())
  curriculumId Int
  courseId     Int
  course       courses     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  currculum    curriculums @relation(fields: [curriculumId], references: [id])

  @@index([curriculumId])
  @@index([courseId])
}

model activities {
  id                Int                 @id @default(autoincrement())
  createdAt         DateTime            @default(now())
  lastUpdated       DateTime            @default(now())
  published         Boolean
  title             String
  summary           String?
  content           String?
  contentUrl        String?             @default("")
  duration          Int?
  activityType      String?
  activityCategory  String?
  activityStatus    String?
  backgroundImg     String?
  moduleId          Int
  ActivityOrder     Int?
  module                    modules                     @relation(fields: [moduleId], references: [id])
  event_activity_progress   event_activity_progress[]

  @@index([moduleId])
}

model events {
  id                Int                 @id @default(autoincrement())
  title             String
  description       String?
  eventType         String?
  projectId         Int
  courseId          Int?
  supportActivityId Int?
  roomId            Int?
  start             DateTime
  end               DateTime
  allDay            Boolean
  color             String?
  textColor         String?
  backgroundColor   String?             @default("#4287f5")
  borderColor       String?
  editable          Boolean?
  eventStatus       String?
  timezone          String?
  extendedProps     Json?
  event_activity_progress event_activity_progress[]
  event_attendees         event_attendees[]
  event_groups            event_groups[]
  event_instructors       event_instructors[]
  course                  courses?                    @relation(fields: [courseId], references: [id])
  project                 projects                    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  supportActivity         supportActivities?          @relation(fields: [supportActivityId], references: [id])
  room                    rooms?                      @relation(fields: [roomId], references: [id])
  event_module_progress   event_module_progress[]

  @@index([projectId])
  @@index([courseId])
  @@index([supportActivityId])
  @@index([roomId])
}

model event_attendees {
  id                Int                  @id @default(autoincrement())
  eventsId          Int
  attendance_status String               @default("scheduled")
  enrolleeId        Int
  attendanceType    String               @default("group") // 'group' or 'individual'
  createdAt         DateTime             @default(now())
  lastUpdated       DateTime             @default(now())
  updatedby         String?
  createdBy         String?
  enrollee          project_participants @relation(fields: [enrolleeId], references: [id])
  event             events               @relation(fields: [eventsId], references: [id], onDelete: Cascade)

  @@unique([eventsId, enrolleeId])
  @@index([eventsId])
  @@index([enrolleeId])
  @@index([attendanceType])
}

model event_groups {
  id       Int    @id @default(autoincrement())
  eventsId Int
  groupId  Int
  event    events @relation(fields: [eventsId], references: [id], onDelete: Cascade)
  groups   groups @relation(fields: [groupId], references: [id])

  @@unique([eventsId, groupId])
  @@index([eventsId])
  @@index([groupId])
}

model daily_focus {
  id        Int      @id @default(autoincrement())
  date      DateTime @db.Date
  focus     String   @db.VarChar(500)
  projectId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  createdBy String
  updatedBy String?
  project   projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([date, projectId])
  @@index([projectId])
}

model daily_training_notes {
  id            Int      @id @default(autoincrement())
  projectId     Int
  date          DateTime @db.Date
  keyHighlights String[] @default([])
  challenges    String[] @default([])
  sessionNotes  String?  @db.Text
  author        String?
  authorRole    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String
  updatedBy     String?
  project       projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, date])
  @@index([projectId])
  @@index([date])
}

model supportActivities {
  id                    Int                     @id @default(autoincrement())
  title                 String
  description           String?
  activityType          String                  @default("General")
  duration              Int?
  isActive              Boolean                 @default(true)
  curriculumId          Int
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  createdBy             String?
  updatedBy             String?
  events                events[]
  curriculum            curriculums             @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  training_plan_modules training_plan_modules[]

  @@index([curriculumId])
  @@index([activityType])
}

model toolAccesses {
  id              Int          @id @default(autoincrement())
  tool            String
  toolType        String?
  toolUrl         String?
  toolDescription String?
  username        String?
  accessCode      String?
  participantId   String
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  createdBy       String?
  updatedBy       String?
  participant     participants @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@index([participantId])
  @@index([tool])
}

model event_instructors {
  id           Int         @id @default(autoincrement())
  eventId      Int
  instructorId Int
  role         String      @default("main")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  event        events      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  instructor   instructors @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@unique([eventId, instructorId])
  @@index([eventId])
  @@index([instructorId])
}

model course_instructors {
  id           Int         @id @default(autoincrement())
  courseId     Int
  instructorId Int
  role         String      @default("main")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  course       courses     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  instructor   instructors @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@unique([courseId, instructorId])
  @@index([courseId])
  @@index([instructorId])
}

model course_checklist_items {
  id                       Int                                           @id @default(autoincrement())
  courseId                 Int
  title                    String
  description              String?
  category                 String                                        @default("general")
  priority                 String                                        @default("medium")
  moduleId                 Int?
  itemOrder                Int?
  participantOnly          Boolean                                       @default(false)
  createdAt                DateTime                                      @default(now())
  updatedAt                DateTime                                      @updatedAt
  createdBy                String?
  updatedBy                String?
  course                   courses                                       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  module                   modules?                                      @relation(fields: [moduleId], references: [id])
  progress                 project_course_checklist_progress[]
  participant_progress     project_participants_course_checklist_progress[]

  @@index([courseId])
  @@index([moduleId])
  @@index([category])
  @@index([priority])
}

model group_curriculums {
  id           Int         @id @default(autoincrement())
  groupId      Int
  curriculumId Int
  isActive     Boolean     @default(true)
  assignedAt   DateTime    @default(now())
  assignedBy   String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  createdBy    String?
  updatedBy    String?
  curriculum   curriculums @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  group        groups      @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, curriculumId])
  @@index([groupId])
  @@index([curriculumId])
}

model topics {
  id                 Int               @id @default(autoincrement())
  title              String
  description        String?
  color              String?
  icon               String?
  isActive           Boolean           @default(true)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  createdBy          String
  updatedBy          String?
  sub_organizationId Int
  course_topics      course_topics[]
  project_topics     project_topics[]
  sub_organization   sub_organizations @relation(fields: [sub_organizationId], references: [id], onDelete: Cascade)

  @@unique([title, sub_organizationId], name: "unique_topic_per_organization")
  @@index([sub_organizationId])
  @@index([title])
  @@index([isActive])
}

model course_topics {
  id        Int      @id @default(autoincrement())
  courseId  Int
  topicId   Int
  createdAt DateTime @default(now())
  createdBy String?
  course    courses  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  topic     topics   @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([courseId, topicId])
  @@index([courseId])
  @@index([topicId])
}

model course_participant_roles {
  id         Int                               @id @default(autoincrement())
  courseId   Int
  roleId     Int
  isRequired Boolean                           @default(true)
  createdAt  DateTime                          @default(now())
  updatedAt  DateTime                          @updatedAt
  createdBy  String?
  updatedBy  String?
  course     courses                           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  role       sub_organization_participant_role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([courseId, roleId])
  @@index([courseId])
  @@index([roleId])
}

model module_participant_roles {
  id         Int                               @id @default(autoincrement())
  moduleId   Int
  roleId     Int
  isRequired Boolean                           @default(true)
  createdAt  DateTime                          @default(now())
  updatedAt  DateTime                          @updatedAt
  createdBy  String?
  updatedBy  String?
  module     modules                           @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  role       sub_organization_participant_role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([moduleId, roleId])
  @@index([moduleId])
  @@index([roleId])
}

model project_course_checklist_progress {
  id              Int                    @id @default(autoincrement())
  projectId       Int
  checklistItemId Int
  completed       Boolean                @default(false)
  completedAt     DateTime?
  completedBy     String?
  notes           String?                @db.VarChar(160)
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  createdBy       String?
  checklistItem   course_checklist_items @relation(fields: [checklistItemId], references: [id], onDelete: Cascade)
  project         projects               @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, checklistItemId])
  @@index([projectId])
  @@index([checklistItemId])
  @@index([completed])
}

model project_participants_course_checklist_progress {
  id              Int                    @id @default(autoincrement())
  projectId       Int
  participantId   Int
  checklistItemId Int
  completed       Boolean                @default(false)
  completedAt     DateTime?
  completedBy     String?
  notes           String?                @db.VarChar(500)
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  createdBy       String?
  updatedBy       String?
  checklistItem   course_checklist_items @relation(fields: [checklistItemId], references: [id], onDelete: Cascade)
  participant     project_participants   @relation(fields: [participantId], references: [id], onDelete: Cascade)
  project         projects               @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, participantId, checklistItemId], name: "unique_participant_checklist_item")
  @@index([projectId])
  @@index([participantId])
  @@index([checklistItemId])
  @@index([completed])
}

model course_objectives {
  id             Int      @id @default(autoincrement())
  courseId       Int
  objective      String
  objectiveOrder Int?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String?
  updatedBy      String?
  course         courses  @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([objectiveOrder])
}

model module_objectives {
  id             Int      @id @default(autoincrement())
  moduleId       Int
  objective      String
  objectiveOrder Int?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String?
  updatedBy      String?
  module         modules  @relation(fields: [moduleId], references: [id], onDelete: Cascade)

  @@index([moduleId])
  @@index([objectiveOrder])
}

model training_plans {
  id           Int                  @id @default(autoincrement())
  curriculumId Int
  projectId    Int?
  title        String
  description  String?
  totalDays    Int                  @default(5)
  status       String               @default("draft")
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  createdBy    String
  updatedBy    String?
  days         training_plan_days[]
  curriculum   curriculums          @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  project      projects?            @relation(fields: [projectId], references: [id])

  @@unique([curriculumId, projectId])
  @@index([curriculumId])
  @@index([projectId])
  @@index([status])
}

model training_plan_days {
  id             Int                     @id @default(autoincrement())
  trainingPlanId Int
  dayNumber      Int
  dayTitle       String?
  dayDescription String?
  date           DateTime?
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  trainingPlan   training_plans          @relation(fields: [trainingPlanId], references: [id], onDelete: Cascade)
  modules        training_plan_modules[]

  @@unique([trainingPlanId, dayNumber])
  @@index([trainingPlanId])
  @@index([dayNumber])
}

model training_plan_modules {
  id                 Int                @id @default(autoincrement())
  trainingPlanDayId  Int
  moduleId           Int?
  courseId           Int?
  supportActivityId  Int?
  customTitle        String?
  customDuration     Int?
  moduleOrder        Int
  activities         Json?
  learningObjectives Json?
  notes              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  course             courses?           @relation(fields: [courseId], references: [id])
  module             modules?           @relation(fields: [moduleId], references: [id])
  supportActivity    supportActivities? @relation(fields: [supportActivityId], references: [id])
  day                training_plan_days @relation(fields: [trainingPlanDayId], references: [id], onDelete: Cascade)

  @@index([trainingPlanDayId])
  @@index([moduleId])
  @@index([courseId])
  @@index([supportActivityId])
  @@index([moduleOrder])
}

model project_topics {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  projectId Int
  topicId   Int
  project   projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
  topic     topics   @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([projectId, topicId], name: "projectId_topicId")
  @@index([projectId])
  @@index([topicId])
}

model event_activity_progress {
  id          Int        @id @default(autoincrement())
  eventId     Int
  activityId  Int
  completed   Boolean    @default(false)
  completedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  event       events     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  activity    activities @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@unique([eventId, activityId])
  @@index([eventId])
  @@index([activityId])
}

model event_module_progress {
  id          Int      @id @default(autoincrement())
  eventId     Int
  moduleId    Int
  completed   Boolean  @default(false)
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  event       events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  module      modules  @relation(fields: [moduleId], references: [id], onDelete: Cascade)

  @@unique([eventId, moduleId])
  @@index([eventId])
  @@index([moduleId])
}

model course_assessments {
  id              Int      @id @default(autoincrement())
  courseId        Int
  title           String
  description     String?  @db.Text
  maxScore        Float    @default(100)
  passingScore    Float    @default(70)
  isActive        Boolean  @default(true)
  assessmentOrder Int?
  allowRetakes    Boolean  @default(true)
  maxAttempts     Int?
  scoreStrategy   String   @default("latest")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdBy       String
  updatedBy       String?
  course                     courses                           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  participant_scores         participant_assessment_scores[]
  curriculum_overrides       curriculum_assessment_config[]
  project_overrides          project_assessment_config[]

  @@index([courseId])
  @@index([isActive])
}

model curriculum_assessment_config {
  id                 Int      @id @default(autoincrement())
  curriculumId       Int
  courseAssessmentId Int
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  createdBy          String?
  updatedBy          String?
  curriculum       curriculums        @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  courseAssessment course_assessments @relation(fields: [courseAssessmentId], references: [id], onDelete: Cascade)

  @@unique([curriculumId, courseAssessmentId], name: "unique_curriculum_assessment")
  @@index([curriculumId])
  @@index([courseAssessmentId])
  @@index([isActive])
}

model project_assessment_config {
  id                 Int      @id @default(autoincrement())
  projectId          Int
  courseAssessmentId Int
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  createdBy          String?
  updatedBy          String?
  project          projects           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  courseAssessment course_assessments @relation(fields: [courseAssessmentId], references: [id], onDelete: Cascade)

  @@unique([projectId, courseAssessmentId], name: "unique_project_assessment")
  @@index([projectId])
  @@index([courseAssessmentId])
  @@index([isActive])
}

model participant_assessment_scores {
  id                 Int      @id @default(autoincrement())
  courseAssessmentId Int
  participantId      Int
  instructorId       Int?
  attemptNumber      Int      @default(1)
  scoreEarned        Float
  scoreMaximum       Float
  scorePercentage    Float
  passed             Boolean?
  isOverridden       Boolean  @default(false)
  overrideReason     String?  @db.Text
  feedback           String?  @db.Text
  assessmentDate     DateTime
  isCurrent          Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  createdBy          String
  updatedBy          String?
  courseAssessment course_assessments   @relation(fields: [courseAssessmentId], references: [id], onDelete: Cascade)
  participant      project_participants @relation(fields: [participantId], references: [id], onDelete: Cascade)
  instructor       instructors?         @relation(fields: [instructorId], references: [id])

  @@unique([courseAssessmentId, participantId, attemptNumber], name: "unique_participant_attempt")
  @@index([courseAssessmentId])
  @@index([participantId])
  @@index([instructorId])
  @@index([passed])
  @@index([attemptNumber])
  @@index([isCurrent])
  @@index([assessmentDate])
  @@index([scorePercentage])
}

model curriculum_checklist_items {
  id              Int                                        @id @default(autoincrement())
  curriculumId    Int
  title           String
  description     String?
  category        String                                     @default("trainer_prep")
  priority        String                                     @default("medium")
  itemOrder       Int?
  createdAt       DateTime                                   @default(now())
  updatedAt       DateTime                                   @updatedAt
  createdBy       String?
  updatedBy       String?
  curriculum      curriculums                                @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  progress        project_curriculum_checklist_progress[]

  @@index([curriculumId])
  @@index([category])
  @@index([priority])
  @@index([itemOrder])
}

model project_curriculum_checklist_progress {
  id              Int                        @id @default(autoincrement())
  projectId       Int
  checklistItemId Int
  completed       Boolean                    @default(false)
  completedAt     DateTime?
  completedBy     String?
  notes           String?                    @db.VarChar(160)
  createdAt       DateTime                   @default(now())
  updatedAt       DateTime                   @updatedAt
  createdBy       String?
  updatedBy       String?
  checklistItem   curriculum_checklist_items @relation(fields: [checklistItemId], references: [id], onDelete: Cascade)
  project         projects                   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, checklistItemId])
  @@index([projectId])
  @@index([checklistItemId])
  @@index([completed])
}

model organization_memberships {
  id                   String        @id @default(uuid())
  userId               String
  organizationId       String
  workos_membership_id String        @unique
  workos_role          String
  status               String        @default("active")
  cached_at            DateTime      @default(now())
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization         organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([userId])
  @@index([organizationId])
  @@index([workos_membership_id])
  @@index([status])
}

// ============================================
// SUBSCRIPTION MANAGEMENT TABLES
// ============================================

model subscription_plans {
  id                  Int             @id @default(autoincrement())
  planId              String          @unique // "essential", "professional", "enterprise"
  name                String          // "Essential", "Professional", "Enterprise"
  description         String?         @db.Text
  trialDays           Int             @default(0)
  isActive            Boolean         @default(true)
  isPublic            Boolean         @default(true) // Show on pricing page

  // Features and Limits (stored as JSON for flexibility)
  features            Json            // Array of feature keys
  resourceLimits      Json            // { maxProjects: 50, maxParticipants: 500, etc. }

  // Stripe Integration - Price/currency/interval fetched from Stripe (source of truth)
  stripeProductId     String?         // Stripe Product ID (prod_xxx)
  stripePriceId       String?         // Stripe monthly Price ID (price_xxx)
  stripeAnnualPriceId String?         // Stripe annual Price ID (price_xxx)

  // Display
  displayOrder        Int             @default(0)
  highlightText       String?         // "Most Popular", "Best Value"

  // Metadata
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  createdBy           String?
  updatedBy           String?

  subscriptions       subscriptions[]

  @@index([planId])
  @@index([isActive])
  @@index([isPublic])
  @@index([displayOrder])
  @@index([stripeProductId])
  @@index([stripePriceId])
}

model subscriptions {
  id                  Int                @id @default(autoincrement())
  organizationId      String             @unique
  organization        organizations      @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  // Plan information
  planId              String             // "essential", "professional", "enterprise"
  plan                subscription_plans @relation(fields: [planId], references: [planId])
  status              String             @default("active") // "active", "trialing", "past_due", "canceled", "suspended"

  // Billing - billingInterval fetched from Stripe (source of truth)
  currentPeriodStart  DateTime           @default(now())
  currentPeriodEnd    DateTime
  cancelAt            DateTime?          // Scheduled cancellation date
  canceledAt          DateTime?          // When it was actually canceled
  trialStart          DateTime?
  trialEnd            DateTime?

  // Payment integration (Stripe, etc.)
  stripeCustomerId    String?            @unique
  stripeSubscriptionId String?           @unique
  stripeProductId     String?
  stripePriceId       String?

  // Custom overrides per organization
  customFeatures      Json?              // Override features for this org
  customLimits        Json?              // Override resource limits for this org

  // Metadata
  notes               String?            @db.Text
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  createdBy           String?
  updatedBy           String?

  history             subscription_history[]

  @@index([organizationId])
  @@index([planId])
  @@index([status])
  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
  @@index([currentPeriodEnd])
}

model subscription_history {
  id                  Int           @id @default(autoincrement())
  subscriptionId      Int
  subscription        subscriptions @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  // Change information
  eventType           String        // "created", "plan_changed", "canceled", "reactivated", "trial_started", "trial_ended", "payment_failed"
  fromPlanId          String?       // Previous plan (for upgrades/downgrades)
  toPlanId            String?       // New plan
  fromStatus          String?       // Previous status
  toStatus            String        // New status

  // Context
  reason              String?       @db.Text // Why the change happened
  changedBy           String?       // User ID who made the change
  changedByRole       String?       // Role of the person who made the change

  // Metadata
  metadata            Json?         // Additional context (prices, discounts, etc.)
  changedAt           DateTime      @default(now())

  @@index([subscriptionId])
  @@index([eventType])
  @@index([changedAt])
  @@index([toPlanId])
}

// ============================================
// CURRICULUM SURVEYS
// ============================================

model curriculum_surveys {
  id                Int       @id @default(autoincrement())
  curriculumId      Int
  title             String
  description       String?   @db.Text
  surveyType        String    @default("post_training") // pre_training, post_training, per_course, custom
  provider          String    // google_forms, microsoft_forms, typeform, surveymonkey

  // Provider configuration (JSON) - stores formUrl, formId, apiKey, spreadsheetId, etc.
  providerConfig    Json

  // Settings
  isRequired        Boolean   @default(true)
  triggerCourseId   Int?      // For per_course surveys
  customTriggerDays Int?      // For custom timing
  displayOrder      Int?

  // Standard fields
  status            String    @default("active") // draft, active, archived
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  createdBy         String
  updatedBy         String?

  curriculum        curriculums @relation(fields: [curriculumId], references: [id], onDelete: Cascade)
  triggerCourse     courses?    @relation("SurveyTriggerCourse", fields: [triggerCourseId], references: [id])

  @@index([curriculumId])
  @@index([status])
  @@index([provider])
  @@index([isActive])
  @@index([triggerCourseId])
}

// ============================================
// ROOMS (Belong to Training Recipients)
// ============================================

model rooms {
  id                  Int       @id @default(autoincrement())
  name                String
  location            String?
  capacity            Int?
  type                String    @default("Physical") // Physical or Virtual
  roomType            String    @default("Conference") // Theatre, U-shape, Classroom, etc.
  status              String    @default("Available") // Available, Occupied, Maintenance
  equipment           String[]  @default([])
  notes               String?   @db.VarChar(500)

  // Training Recipient Scoping
  trainingRecipientId Int
  training_recipient  training_recipients @relation(fields: [trainingRecipientId], references: [id], onDelete: Cascade)

  // Event relation
  events              events[]

  // Audit Fields
  isActive            Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  createdBy           String    // WorkOS user ID
  updatedBy           String?

  @@index([trainingRecipientId])
  @@index([status])
  @@index([type])
  @@index([roomType])
  @@index([isActive])
}

// ============================================
// SYSTEM ROLES (Level 2-4 Application Roles)
// ============================================

model system_roles {
  id              Int       @id @default(autoincrement())
  slug            String    @unique // "training_manager", "training_coordinator", "instructor", "participant", "viewer"
  name            String    // "Training Manager"
  description     String?
  hierarchyLevel  Int       // 2, 3, 4 (Level 0-1 handled by WorkOS)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  assignments     user_role_assignments[]
  role_permissions role_permissions[]
  organization_role_overrides organization_role_overrides[]

  @@index([slug])
  @@index([hierarchyLevel])
  @@index([isActive])
}

// ============================================
// USER ROLE ASSIGNMENTS (Level 2-4 only)
// ============================================

model user_role_assignments {
  id                  Int       @id @default(autoincrement())
  userId              String
  roleId              Int
  organizationId      String
  assignedAt          DateTime  @default(now())
  assignedBy          String    // WorkOS user ID who assigned
  isActive            Boolean   @default(true)

  user                User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  role                system_roles  @relation(fields: [roleId], references: [id])
  organization        organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId]) // One role per user per org
  @@index([userId])
  @@index([roleId])
  @@index([organizationId])
  @@index([isActive])
}

// ============================================
// PERMISSIONS CATALOG
// ============================================

model permissions {
  id              Int       @id @default(autoincrement())
  key             String    @unique // "projects:create", "events:edit:assigned"
  name            String    // "Create Projects"
  description     String?
  resource        String    // "projects", "events", "courses"
  action          String    // "create", "read", "update", "delete"
  scope           String?   // null (all), "own", "assigned", "enrolled"
  category        String    // "projects", "courses", "resources", "user_management"
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())

  role_permissions role_permissions[]
  organization_role_overrides organization_role_overrides[]

  @@index([key])
  @@index([resource])
  @@index([category])
  @@index([isActive])
}

// ============================================
// DEFAULT ROLE-PERMISSION MAPPING (System-wide)
// ============================================

model role_permissions {
  id              Int         @id @default(autoincrement())
  roleId          Int
  permissionId    Int
  createdAt       DateTime    @default(now())

  role            system_roles @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission      permissions  @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
}

// ============================================
// ORGANIZATION-SPECIFIC PERMISSION OVERRIDES
// ============================================

model organization_role_overrides {
  id              Int         @id @default(autoincrement())
  organizationId  String
  roleId          Int
  permissionId    Int
  isEnabled       Boolean     // true = explicitly enabled, false = explicitly disabled
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  updatedBy       String      // WorkOS user ID who made the change

  organization    organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  role            system_roles  @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission      permissions   @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([organizationId, roleId, permissionId])
  @@index([organizationId])
  @@index([roleId])
  @@index([permissionId])
}

// ============================================
// PROVIDER USAGE TRACKING
// ============================================

model usage_logs {
  id                Int       @id @default(autoincrement())
  provider          String    // "gemini", "maps", "resend", "r2"
  action            String    // "summarize", "autocomplete", "send_email", "upload"
  organizationId    String?
  userId            String?   // WorkOS user ID
  projectId         Int?

  // Request metadata
  inputSize         Int?      // chars, bytes, or count
  outputSize        Int?
  durationMs        Int?
  success           Boolean   @default(true)
  errorCode         String?

  // Actual token usage (from provider API response)
  inputTokens       Int?      // Actual input tokens (Gemini API)
  outputTokens      Int?      // Actual output tokens (Gemini API)
  totalTokens       Int?      // Total tokens used

  // Cost estimation
  estimatedCostUsd  Float?

  createdAt         DateTime  @default(now())

  @@index([organizationId, createdAt])
  @@index([provider, createdAt])
  @@index([userId, createdAt])
  @@index([createdAt])
  @@index([provider, organizationId])
}
